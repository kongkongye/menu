---
layout: post
title:  变量
categories: 专题
author: kongkongye
---

* content
{:toc}

变量是什么? 变量不是固定的值,可能根据玩家,时间,场景的不同而呈现不同的值, 比如不同玩家有不同名字,同一个玩家在不同时间有不同的生命值,金钱等.

此插件提供了多种不同类型的变量,还包含管道功能,可以增加更多的灵活性.

并且此插件的服务器全局变量接入了比较流行的`PlaceholderAPI`,省去了重复劳动.




## 变量格式
`{变量类型:变量名|[管道名-]管道数据}`

具体的可以有以下几个情况:

1. 无管道: `{变量类型:变量名}`
2. 映射管道: `{变量类型:变量名|管道数据}`,管道数据即映射名,相当于`{变量类型:变量名|map-管道数据}`,其中`map`就是映射管道名
3. 其它管道: `{变量类型:变量名|管道名-管道数据}`
4. 多个管道: `{变量类型:变量名|管道名-管道数据|管道名-管道数据}`

## 变量类型
共有6大变量类型

1. 全局变量
    1. 本地全局变量
    2. 服务器全局变量
2. 页面变量
    1. 本地页面变量
    2. 服务器页面变量
3. 列表变量
    1. 本地列表变量
    2. 服务器列表变量
4. 命令变量
5. 输入变量
6. 局部变量

#### 1. 全局变量(global)
菜单的`menu`元素可配置`server`属性,如果为true,则将使用服务器全局变量,否则将使用本地全局变量.

全局变量只可能跟玩家有关,跟页面内的命令变量无关.

##### 本地全局变量
其它客户端MOD可以在菜单MOD上注册额外的本地全局变量,本地全局变量格式为`{global:本地全局变量名_本地全局变量值}`

##### 服务器全局变量
在服务器端,全局变量使用`PlaceholderAPI`插件,如果你要注册额外的服务器全局变量,
直接在PlaceholderAPI上注册变量就可以使用了.

具体的变量转换关系为: 在PlaceholderAPI插件内,变量是`%xxx%`格式,在此菜单MOD内,变量使用`{global:xxx}`格式.
比如PlaceholderAPI插件的变量是`%Player_name%`,那么在此插件内相应的变量就是`{global:Player_name}`

#### 2. 页面变量(page)
菜单的`menu`元素可配置`server`属性,如果为true,则将使用服务器页面变量,否则将使用本地页面变量.

页面变量一般跟传入的命令变量有关,对应菜单配置`menu`元素的`pageContext`页面上下文属性.

比如玩家要进入查看领地信息,那么需要传入命令变量`领地ID`,然后由领地插件解析后提供相应的页面变量.

比如有个`领地信息`页面,玩家进入此页面后,可以展示指定领地的信息,
包括领地ID,领地名,领地大小,领地所有者等,那么这些就属于页面变量.

##### 本地页面变量
其它客户端MOD可以在菜单MOD上注册额外的本地页面变量

##### 服务器页面变量
其它服务端插件可以在菜单插件上注册额外的服务器页面变量

#### 3. 列表变量(list)
菜单的`menu`元素可配置`server`属性,如果为true,则将使用服务器列表变量,否则将使用本地列表变量.

列表变量与上面的页面变量类似,一般也与传入的命令变量有关,对应菜单配置`menu`元素的`listContext`列表上下文属性.

比如有个`领地信息`页面,里面包括子领地列表,那子领地的ID,名字,所有者等这些就属于列表变量.

##### 本地列表变量
其它客户端MOD可以在菜单MOD上注册额外的本地列表变量

##### 服务器列表变量
其它服务端插件可以在菜单插件上注册额外的服务器列表变量

#### 4. 命令变量(cmd)
就是加入菜单时传入的命令变量,在菜单的整个生命周期内都是固定不变的.

比如使用命令`/menu join main tp id=1 name=jim`里,命令变量有:

* `id`: 值为'1'
* `name`: 值为'jim'

#### 5. 输入变量(input)
即玩家在页面中输入的变量

比如页面中有`input`输入元素,`name`变量名属性为`amount`,
那么可以在菜单内这样使用: `你输入的数量是{input:amount}`

#### 6. 本地变量(local)
即描述当前页面状态的一些变量,包括:

* `name`: 玩家名
* `repo`: 此菜单所属仓库
* `namespace`: 此菜单所属命名空间
* `path`: 此菜单所属路径
* `title`: 菜单标题
* `preMenuAmount`: 前面的菜单数(0表示没有)
* `listIndex`: 列表位置(指当前变量所属元素所属的行在列表中的位置,>=0,从0开始,无列表时返回-1)
* `listIndexAdd`: 列表位置(指当前变量所属元素所属的行在列表中的位置,>=1,从1开始,无列表时返回-1)
* `listPage`: 列表当前页(>=1,从1开始)
* `listPageSize`: 列表页面大小(>=1,0表示无页面)
* `listPageAmount`: 列表当前页的元素数量(>=0)
* `listPageMax`: 列表最大页(>=1)
* `listTotal`: 列表元素总数(>=0)

## 变量生效范围
基本上菜单配置中所有可配置显示字符串的地方都可包含变量

如果变量解析结果为null或空或出异常,则会被替换为`空字符串`.

具体可包含变量的位置包括:

* `menu`菜单元素的`title`标题属性: 如果是入口菜单,则标题内不能包含变量
* `hovers内hover内line`行元素的内容
* `line`行元素的内容
* 所有元素的`hover`悬浮文字属性
* 所有元素的`condition`条件属性
* `items`物品元素的`param`变量属性: 可以使用命令变量
* `text`文本元素的内容
* `button`按钮元素的`value`值属性
* `button`按钮元素的内容
* `input`输入元素的`default`默认值属性: 可以使用命令变量

在实际使用上,请尽量以正常的逻辑来使用变量,比如你将输入变量的默认值设置为'{input:xxx}',此时输入变量值还没有出来,因此结果肯定为空.

## 管道
管道用来转换变量值,第三方客户端MOD可注册额外的管道

要注意的是,管道只有本地管道,而没有服务器管道.

#### 多个管道会串行
即变量值会依次经过多个管道

比如`{global:isVip|bool|boolShow}`,首先通用变量`isVip`的值为`1`,然后经过`bool`管道,将`1`映射为`true`,
然后经过`boolShow`管道,将true映射为`是`.

此外变量值始终会依次经过多个管道,即使中间某个管道没对变量值作出改变(但一般多个管道用的不是很多).

## 内置管道

#### 映射管道(map)
此菜单MOD内置了一个常用的映射管道,管道名为`map`,配置文件中配置的`maps`元素就是映射管道配置.

可以当作`映射`来用,比如提供变量值`true/false`,显示时你可以将它转换成`是/否`或`成功/失败`等.
可以当作`条件`选择来用,比如一旦插件提供的变量值是`0`,便显示为`无`

## 内置物品变量

#### 简易物品(simple)
物品变量名为`simple`,变量值格式为`id:伤害值:数量,...`

比如1个石头为`1:0:1`,比如1个草地与2个泥土为`2:0:1,3:0:2`.

## 内置全局与页面与列表变量
**注意!这些内置变量是菜单MOD内部菜单使用的变量,一般情况下不需要了解.**

#### 本地全局变量: MOD信息(MENU-ModInfo)
变量类型为`MENU-ModInfo`,提供的本地全局变量值有:

* `name`: 此菜单MOD名
* `version`: 此菜单MOD版本
* `configFolder`: 此菜单MOD的配置目录的完整路径

#### 本地全局变量: 状态(MENU-status)
变量类型为`MENU-status`,提供的本地全局变量值有:

* `connectServer`: true/false,是否连接上服务器

#### 本地页面变量: 主题(MENU-theme)
变量类型为`MENU-theme`,提供页面变量:

* `currentThemeId`: 当前选择的主题id
* `showThemeName`: 当前使用的主题名
* `serverThemeName`: 服务器主题名

#### 本地页面变量: 第三方命名空间(MENU-thirdNamespace)
变量类型为`MENU-thirdNamespace`,需要输入变量:

* `namespace`: 命名空间名

提供页面变量:

* `currentThemeId`: 当前选择的主题id
* `showThemeName`: 当前使用的主题名
* `serverThemeName`: 服务器主题名

#### 本地列表变量: 第三方主题(MENU-thirdThemes)
提供主题的相关信息,变量类型为`MENU-thirdThemes`,提供列表变量:

* `id`: 主题id
* `name`: 主题名

#### 本地列表变量: 所有的本地+第三方入口菜单(MENU-localMenus)
提供所有本地与第三方命名空间的入口菜单的相关信息,变量类型为`MENU-localMenus`,提供列表变量:

* `repo`: 仓库
* `namespace`: 命名空间
* `path`: 路径
* `title`: 菜单标题

#### 本地列表变量: 指定命名空间内的第三方入口菜单(MENU-thirdIndexMenus)
提供入口菜单的相关信息,变量类型为`MENU-thirdIndexMenus`,需要输入变量:

* `namespace`: 命名空间名

提供列表变量:

* `repo`: 仓库(在这里值为`third`)
* `namespace`: 命名空间
* `path`: 路径
* `title`: 菜单标题

#### 本地列表变量: 第三方菜单管理内的命名空间列表(MENU-thirdMenusManage)
变量类型为`MENU-thirdMenusManage`,提供列表变量:

* `namespace`: 命名空间
* `name`: 第三方命名空间名称,可为空
* `description`: 第三方命名空间描述,可为空
* `version`: 第三方命名空间版本,可为空
* `author`: 第三方命名空间作者,可为空
* `website`: 第三方命名空间网站,可为空

#### 服务器列表变量: 所有的服务器入口菜单(MENU-main)
变量类型为`MENU-main`,提供列表变量:

* `namespace`: 命名空间
* `path`: 路径
* `title`: 菜单标题
